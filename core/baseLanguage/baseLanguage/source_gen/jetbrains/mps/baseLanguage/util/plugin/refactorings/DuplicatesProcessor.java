package jetbrains.mps.baseLanguage.util.plugin.refactorings;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.EditorContext;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.nodeEditor.EditorMessage;

public abstract class DuplicatesProcessor<T> {
  protected EditorContext myEditorContext;

  public DuplicatesProcessor(EditorContext context) {
    this.myEditorContext = context;
  }

  public void process(List<T> duplicates) {
    boolean replaceAll = false;
    for (T duplicate : ListSequence.fromList(duplicates)) {
      if (!(replaceAll)) {
        List<EditorMessage> messages = this.createEditorMessages(duplicate);
        this.myEditorContext.getNodeEditorComponent().getHighlightManager().mark(messages);
        AskDialog dialog = new AskDialog(this.myEditorContext.getOperationContext().getMainFrame(), "Process Duplicates");
        dialog.showDialog();
        AskDialog.DialogResults shouldSubstitute = dialog.getResult();
        for (EditorMessage message : ListSequence.fromList(messages)) {
          this.myEditorContext.getNodeEditorComponent().getHighlightManager().unmark(message);
        }
        myEditorContext.getNodeEditorComponent().getHighlightManager().repaintAndRebuildEditorMessages();
        if (shouldSubstitute == AskDialog.DialogResults.SUBSTITUTE) {
          this.substitute(duplicate);
        } else if (shouldSubstitute == AskDialog.DialogResults.SUBSTITUTE_ALL) {
          this.substitute(duplicate);
          replaceAll = true;
        } else if (shouldSubstitute == AskDialog.DialogResults.CANCEL_ALL) {
          break;
        }
      } else {
        this.substitute(duplicate);
      }
    }
  }

  protected abstract List<EditorMessage> createEditorMessages(T duplicate);

  public abstract void substitute(T duplicate);
}
