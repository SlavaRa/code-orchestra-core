package jetbrains.mps.internal.make.runtime.script;

/*Generated by MPS */

import jetbrains.mps.logging.Logger;

public class LoggingProgressStrategy extends AbstractProgressStrategy {
  private static Logger LOG = Logger.getLogger(LoggingProgressStrategy.class.getPackage().getName());
  private static String TOTAL = "\u221e";

  private String lastInfo = null;
  private LoggingProgressStrategy.Log logger = new LoggingProgressStrategy.Log() {
    public void error(String text) {
      LoggingProgressStrategy.LOG.error(text);
    }

    public void warning(String text) {
      LoggingProgressStrategy.LOG.warning(text);
    }

    public void info(String text) {
      LoggingProgressStrategy.LOG.info(text);
    }
  };

  public LoggingProgressStrategy() {
    super(TOTAL);
  }

  /**
   * For testing only.
   */
  public LoggingProgressStrategy(LoggingProgressStrategy.Log log) {
    this();
    this.logger = log;
  }

  protected void begunWork(AbstractProgressStrategy.Work wrk) {
    if (lastInfo != null) {
      logger.info(lastInfo);
      lastInfo = null;
    }
    logger.info(wrk.fullName() + " -- started");
  }

  protected void advancedWork(AbstractProgressStrategy.Work wrk) {
    if (lastInfo != null) {
      logger.info(lastInfo);
      lastInfo = null;
    }
    double p = wrk.doneRatio();
    int prg = (int) Math.ceil(p * 100);
    if (prg == 100) {
      this.lastInfo = wrk.fullName() + " -- done " + (prg) + "%";
    } else {
      logger.info(wrk.fullName() + " -- done " + (prg) + "%");
    }
  }

  protected void finishedWork(AbstractProgressStrategy.Work wrk) {
    if (lastInfo != null) {
      logger.info(lastInfo);
      lastInfo = null;
    }
    logger.info(wrk.fullName() + " -- finished");
  }

  public static interface Log {
    public void error(String text);
    public void warning(String text);
    public void info(String text);
  }
}
