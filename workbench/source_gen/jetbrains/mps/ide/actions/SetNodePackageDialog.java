package jetbrains.mps.ide.actions;

/*Generated by MPS */

import jetbrains.mps.ide.dialogs.BaseDialog;
import javax.swing.JPanel;
import javax.swing.JComboBox;
import java.awt.Frame;
import java.util.List;
import java.awt.GridBagLayout;
import java.awt.GridBagConstraints;
import java.awt.Insets;
import javax.swing.JLabel;
import javax.swing.DefaultComboBoxModel;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;
import java.awt.event.KeyAdapter;
import java.awt.event.KeyEvent;
import javax.swing.JComponent;
import jetbrains.mps.ide.dialogs.DialogDimensionsSettings;

public class SetNodePackageDialog extends BaseDialog {
  private boolean myIsCancelled = true;
  private JPanel myMainPanel;
  private JComboBox myCbPackage;
  private String myPackage;

  public SetNodePackageDialog(Frame frame, String title, List<String> existingPackages) {
    super(frame, title);
    setModal(true);
    myMainPanel = new JPanel();
    myMainPanel.setLayout(new GridBagLayout());
    GridBagConstraints c = new GridBagConstraints(0, 0, 1, 1, 1, 0, GridBagConstraints.NORTHWEST, GridBagConstraints.HORIZONTAL, new Insets(0, 0, 0, 0), 0, 0);
    myMainPanel.add(new JLabel("Enter virtual package name:"), c);
    myCbPackage = new JComboBox();
    myCbPackage.setEditable(true);
    myCbPackage.setModel(new DefaultComboBoxModel(ListSequence.fromList(existingPackages).toGenericArray(String.class)));
    myCbPackage.addActionListener(new ActionListener() {
      public void actionPerformed(ActionEvent e) {
        myPackage = ((String) myCbPackage.getSelectedItem());
      }
    });
    myCbPackage.getEditor().getEditorComponent().addKeyListener(new KeyAdapter() {
      public void keyPressed(KeyEvent e) {
        if (e.getKeyCode() == KeyEvent.VK_ENTER && !(myCbPackage.isPopupVisible())) {
          onOk();
        }
      }
    });
    c.gridy = 1;
    myMainPanel.add(myCbPackage, c);
    c.gridy = 2;
    c.weighty = 1.0;
    myMainPanel.add(new JPanel(), c);
  }

  protected JComponent getMainComponent() {
    return myMainPanel;
  }

  public DialogDimensionsSettings.DialogDimensions getDefaultDimensionSettings() {
    return new DialogDimensionsSettings.DialogDimensions(100, 200, 250, 150);
  }

  public String getPackage() {
    return myPackage;
  }

  private void updatePackage() {
    String pack = ((String) myCbPackage.getEditor().getItem());
    if (pack != null && pack.length() == 0) {
      pack = null;
    }
    myPackage = pack;
  }

  public void setPackage(String pack) {
    if (pack == null) {
      pack = "";
    }
    myCbPackage.setSelectedItem(pack);
  }

  public boolean isCancelled() {
    return myIsCancelled;
  }

  @BaseDialog.Button(name = "OK", mnemonic = 'O', position = 0, defaultButton = true)
  public void onOk() {
    updatePackage();
    myIsCancelled = false;
    dispose();
  }

  @BaseDialog.Button(name = "Cancel", mnemonic = 'C', position = 1)
  public void onCancel() {
    dispose();
  }
}
