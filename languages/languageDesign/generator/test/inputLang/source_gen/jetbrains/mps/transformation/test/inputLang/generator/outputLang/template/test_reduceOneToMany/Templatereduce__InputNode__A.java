package jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany;

/*Generated by MPS */

import jetbrains.mps.generator.runtime.TemplateDeclarationWeavingAware;
import jetbrains.mps.smodel.SNodePointer;
import java.util.Collection;
import jetbrains.mps.smodel.SNode;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.generator.runtime.TemplateExecutionEnvironment;
import jetbrains.mps.generator.runtime.TemplateContext;
import jetbrains.mps.generator.runtime.GenerationException;
import java.util.List;
import java.util.ArrayList;
import jetbrains.mps.generator.template.SourceSubstituteMacroNodesContext;
import jetbrains.mps.generator.runtime.TemplateUtil;

public class Templatereduce__InputNode__A implements TemplateDeclarationWeavingAware {
  private static SNodePointer loopMacroRef_b8tv7e_a0a0a1a1 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "3893401255414161782");
  private static SNodePointer templateNode_b8tv7e_a0a0a3a2a2a1a1 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "3893401255414100171");
  private static SNodePointer templateNode_b8tv7e_a0a0a1a2 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1391450457158185608");
  private static SNodePointer includeMacro_b8tv7e_a0a0a1a3 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480068639");
  private static SNodePointer includedTemplateNode_b8tv7e_a0a0a1a1a3 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480251689");
  private static SNodePointer switchMacroRef_b8tv7e_a0a0a1a4 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480310365");
  private static SNodePointer templateSwitchNodeNoInput_b8tv7e_a0a0a1a1a4 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480310366");
  private static SNodePointer templateNode_b8tv7e_a0a0a1a2a1a1a4 = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480310362");
  private static SNodePointer weaveTfConst_b8tv7e_a0b0g = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "3893401255414100173");
  private static SNodePointer weaveTfConst_b8tv7e_a0e0g = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1391450457158185609");
  private static SNodePointer weaveTfConst_b8tv7e_a0h0g = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480068637");
  private static SNodePointer weaveTfConst_b8tv7e_a0k0g = new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "1892993302480310363");

  public Templatereduce__InputNode__A() {
  }

  public SNodePointer getTemplateNode() {
    return new SNodePointer("r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691(jetbrains.mps.transformation.test.inputLang.generator.outputLang.template.test_reduceOneToMany@generator)", "3893401255414100167");
  }

  protected Collection<SNode> applyPart0(@NotNull final TemplateExecutionEnvironment environment, @NotNull final TemplateContext context) throws GenerationException {
    final List<SNode> tlist1 = new ArrayList();
    try {
      environment.getTracer().pushMacro(loopMacroRef_b8tv7e_a0a0a1a1);
      final Iterable<SNode> loopList1 = QueriesGenerated.sourceNodesQuery_3893401255414161783(environment.getOperationContext(), new SourceSubstituteMacroNodesContext(context.getInput(), null, loopMacroRef_b8tv7e_a0a0a1a1, context, environment.getGenerator()));
      for (SNode itnode1 : loopList1) {
        if (itnode1 == null) {
          continue;
        }
        boolean inputChanged1 = context.getInput() != itnode1;
        try {
          if (inputChanged1) {
            environment.getTracer().pushInputNode(itnode1);
          }
          TemplateContext context1 = context.subContext(null, itnode1);
          final SNode tnode2 = new SNode(environment.getOutputModel(), "jetbrains.mps.transformation.test.outputLang.structure.OutputNode", false);
          try {
            environment.getTracer().pushTemplateNode(templateNode_b8tv7e_a0a0a3a2a2a1a1);
            environment.nodeCopied(context1, tnode2, "tpl/r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691/3893401255414100171");
            tnode2.setProperty("text", "child #1");

          } finally {
            environment.getTracer().pushOutputNode(tnode2);
            environment.getTracer().closeTemplateNode(templateNode_b8tv7e_a0a0a3a2a2a1a1);
          }
          if (tnode2 != null) {
            tlist1.add(tnode2);
          }
        } finally {
          if (inputChanged1) {
            environment.getTracer().closeInputNode(itnode1);
          }
        }
      }
    } finally {
      environment.getTracer().closeMacro(loopMacroRef_b8tv7e_a0a0a1a1);
    }
    return tlist1;
  }

  protected SNode applyPart1(@NotNull final TemplateExecutionEnvironment environment, @NotNull final TemplateContext context) throws GenerationException {
    final SNode tnode3 = new SNode(environment.getOutputModel(), "jetbrains.mps.transformation.test.outputLang.structure.OutputNode", false);
    try {
      environment.getTracer().pushTemplateNode(templateNode_b8tv7e_a0a0a1a2);
      environment.nodeCopied(context, tnode3, "tpl/r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691/1391450457158185608");
      tnode3.setProperty("text", "child #2");

    } finally {
      environment.getTracer().pushOutputNode(tnode3);
      environment.getTracer().closeTemplateNode(templateNode_b8tv7e_a0a0a1a2);
    }
    return tnode3;
  }

  protected Collection<SNode> applyPart2(@NotNull final TemplateExecutionEnvironment environment, @NotNull final TemplateContext context) throws GenerationException {
    Collection<SNode> tlist4 = null;
    try {
      environment.getTracer().pushMacro(includeMacro_b8tv7e_a0a0a1a3);
      try {
        environment.getTracer().pushTemplateNode(includedTemplateNode_b8tv7e_a0a0a1a1a3);
        tlist4 = new Templatereduce__InputNode__A__included().apply(environment, context);
      } finally {
        environment.getTracer().pushTemplateNode(includedTemplateNode_b8tv7e_a0a0a1a1a3);
      }

    } finally {
      environment.getTracer().closeMacro(includeMacro_b8tv7e_a0a0a1a3);
    }
    return tlist4;
  }

  protected Collection<SNode> applyPart3(@NotNull final TemplateExecutionEnvironment environment, @NotNull final TemplateContext context) throws GenerationException {
    Collection<SNode> tlist5 = null;
    try {
      environment.getTracer().pushMacro(switchMacroRef_b8tv7e_a0a0a1a4);
      try {
        environment.getTracer().pushSwitch(templateSwitchNodeNoInput_b8tv7e_a0a0a1a1a4);
        tlist5 = environment.trySwitch(templateSwitchNodeNoInput_b8tv7e_a0a0a1a1a4, null, context);
        if (tlist5 == null) {
          final SNode tnode6 = new SNode(environment.getOutputModel(), "jetbrains.mps.transformation.test.outputLang.structure.OutputNode", false);
          try {
            environment.getTracer().pushTemplateNode(templateNode_b8tv7e_a0a0a1a2a1a1a4);
            environment.nodeCopied(context, tnode6, "tpl/r:eca8e1c7-93fd-4ddf-9db6-91f9c2320691/1892993302480310362");

          } finally {
            environment.getTracer().pushOutputNode(tnode6);
            environment.getTracer().closeTemplateNode(templateNode_b8tv7e_a0a0a1a2a1a1a4);
          }
          if (tnode6 != null) {
            tlist5 = TemplateUtil.singletonList(tnode6);
          }
        }
      } finally {
        // TODO close switch node 
      }
    } finally {
      environment.getTracer().closeMacro(switchMacroRef_b8tv7e_a0a0a1a4);
    }
    return tlist5;
  }

  public Collection<SNode> apply(@NotNull TemplateExecutionEnvironment environment, @NotNull TemplateContext context) throws GenerationException {
    return TemplateUtil.asList(applyPart0(environment, context), applyPart1(environment, context), applyPart2(environment, context), applyPart3(environment, context));
  }

  public Collection<SNode> weave(@NotNull TemplateExecutionEnvironment environment, @NotNull TemplateContext context, @NotNull SNode outputContextNode) throws GenerationException {
    Collection<SNode> tlistpart0 = applyPart0(environment, context);
    SNodePointer weaveTf0 = weaveTfConst_b8tv7e_a0b0g;
    for (SNode nodeToWeave : TemplateUtil.asNotNull(tlistpart0)) {
      environment.weaveNode(outputContextNode, "outputChild", nodeToWeave, weaveTf0, context.getInput());
    }
    SNode tnodepart1 = applyPart1(environment, context);
    SNodePointer weaveTf1 = weaveTfConst_b8tv7e_a0e0g;
    environment.weaveNode(outputContextNode, "outputChild", tnodepart1, weaveTf1, context.getInput());
    Collection<SNode> tlistpart2 = applyPart2(environment, context);
    SNodePointer weaveTf2 = weaveTfConst_b8tv7e_a0h0g;
    for (SNode nodeToWeave : TemplateUtil.asNotNull(tlistpart2)) {
      environment.weaveNode(outputContextNode, "outputChild", nodeToWeave, weaveTf2, context.getInput());
    }
    Collection<SNode> tlistpart3 = applyPart3(environment, context);
    SNodePointer weaveTf3 = weaveTfConst_b8tv7e_a0k0g;
    for (SNode nodeToWeave : TemplateUtil.asNotNull(tlistpart3)) {
      environment.weaveNode(outputContextNode, "outputChild", nodeToWeave, weaveTf3, context.getInput());
    }
    return TemplateUtil.asList(tlistpart0, tnodepart1, tlistpart2, tlistpart3);
  }
}
