package jetbrains.mps.platform.conf.stubs;

/*Generated by MPS */

import jetbrains.mps.stubs.util.PathItem;
import java.io.InputStream;
import org.jdom.input.SAXBuilder;
import jetbrains.mps.util.JDOMUtil;
import java.io.IOException;
import org.jdom.JDOMException;
import jetbrains.mps.stubs.util.PathItemsReloadableCache;

public class ConfPathItem extends PathItem {
  private static String SUFFIX = ".xml";

  public ConfPathItem(String path) {
    super(path);
  }

  @Override
  protected boolean accepResource(String pkg, String res) {
    if (res == null || !(res.endsWith(SUFFIX))) {
      return false;
    }
    InputStream is = null;
    try {
      is = this.openResource(pkg, res);
      SAXBuilder saxBuilder = JDOMUtil.createBuilder();
      return ConfReader.canRead(saxBuilder.build(is));
    } catch (IOException e) {
      return false;
    } catch (JDOMException e) {
      return false;
    } finally {
      if (is != null) {
        try {
          is.close();
        } catch (IOException e) {
        }
      }
    }
  }

  public String baseName(String res) {
    if (res == null) {
      return null;
    }
    return (res.endsWith(ConfPathItem.SUFFIX) ?
      res.substring(0, res.length() - ConfPathItem.SUFFIX.length()) :
      res
    );
  }

  public static PathItem getPathItem(String path) {
    return PathItemsReloadableCache.getInstance(ConfPathItem.class).getPathItem(path);
  }
}
