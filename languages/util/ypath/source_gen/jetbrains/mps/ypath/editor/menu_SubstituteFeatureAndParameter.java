package jetbrains.mps.ypath.editor;

/*Generated by MPS */

import jetbrains.mps.lang.editor.generator.internal.AbstractCellMenuComponent;
import jetbrains.mps.nodeEditor.cellMenu.SubstituteInfoPart;
import jetbrains.mps.lang.editor.generator.internal.AbstractCellMenuPart_Generic_Group;
import java.util.List;
import jetbrains.mps.smodel.SNode;
import jetbrains.mps.smodel.IScope;
import jetbrains.mps.smodel.IOperationContext;
import jetbrains.mps.util.Pair;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.ypath.runtime.TraversalAxis;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.typesystem.inference.TypeChecker;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.ypath.behavior.TreePath_Behavior;
import jetbrains.mps.ypath.behavior.ITreePathExpression_Behavior;
import jetbrains.mps.ypath.actions.TraversalAxisUtil;
import jetbrains.mps.ypath.behavior.IParamFeature_Behavior;
import jetbrains.mps.smodel.SModel;
import jetbrains.mps.nodeEditor.EditorContext;

public class menu_SubstituteFeatureAndParameter extends AbstractCellMenuComponent {
  public menu_SubstituteFeatureAndParameter() {
    super(new SubstituteInfoPart[]{new menu_SubstituteFeatureAndParameter.IterateOperation_generic_cellMenu_a0()});
  }

  public static class IterateOperation_generic_cellMenu_a0 extends AbstractCellMenuPart_Generic_Group {
    public IterateOperation_generic_cellMenu_a0() {
    }

    public List<?> createParameterObjects(SNode node, IScope scope, IOperationContext operationContext) {
      List<Pair> res = ListSequence.fromList(new ArrayList<Pair>());
      ListSequence.fromList(res).addElement(new Pair(null, null));
      TraversalAxis axis = TraversalAxis.parseValue(SPropertyOperations.getString_def(node, "axis", "DESCENDANTS"));
      SNode tpoe = SNodeOperations.getAncestor(node, "jetbrains.mps.ypath.structure.TreePathOperationExpression", false, false);
      if (SNodeOperations.isInstanceOf(TypeChecker.getInstance().getTypeOf(SLinkOperations.getTarget(tpoe, "operand", true)), "jetbrains.mps.ypath.structure.TreePathType")) {
        SNode nodeType = SLinkOperations.getTarget(SNodeOperations.cast(TypeChecker.getInstance().getTypeOf(SLinkOperations.getTarget(tpoe, "operand", true)), "jetbrains.mps.ypath.structure.TreePathType"), "nodeType", true);
        for (SNode feat : Sequence.fromIterable(TreePath_Behavior.call_getFeature_1213877481312(ITreePathExpression_Behavior.call_getTreePath_1213877496973(tpoe), nodeType))) {
          if (TraversalAxisUtil.isAcceptableFeatureForAxis(feat, axis)) {
            if (SNodeOperations.isInstanceOf(feat, "jetbrains.mps.ypath.structure.IParamFeature")) {
              for (SNode pw : ListSequence.fromList(IParamFeature_Behavior.call_getParameterObjects_1213877340242(SNodeOperations.cast(feat, "jetbrains.mps.ypath.structure.IParamFeature"), nodeType))) {
                ListSequence.fromList(res).addElement(new Pair<SNode, SNode>(feat, pw));
              }
            } else {
              ListSequence.fromList(res).addElement(new Pair<SNode, Object>(feat, null));
            }
          }
        }
      }
      return res;
    }

    protected void handleAction(Object parameterObject, SNode node, SModel model, IScope scope, IOperationContext operationContext, EditorContext editorContext) {
      this.handleAction_impl((Pair) parameterObject, node, model, scope, operationContext, editorContext);
    }

    public void handleAction_impl(Pair parameterObject, SNode node, SModel model, IScope scope, IOperationContext operationContext, EditorContext editorContext) {
      SNode fe = (SNode) parameterObject.o1;
      SNode pw = (SNode) parameterObject.o2;
      SLinkOperations.setTarget(node, "paramObject", pw, true);
      SLinkOperations.setTarget(node, "usedFeature", fe, false);
    }

    public boolean isReferentPresentation() {
      return false;
    }

    public String getMatchingText(Object parameterObject) {
      return this.getMatchingText_internal((Pair) parameterObject);
    }

    public String getMatchingText_internal(Pair parameterObject) {
      SNode fe = (SNode) parameterObject.o1;
      SNode pw = (SNode) parameterObject.o2;
      if ((fe == null)) {
        return "*";
      } else
      if ((pw != null)) {
        return SPropertyOperations.getString(pw, "name") + " | " + SPropertyOperations.getString(fe, "name");
      } else {
        return SPropertyOperations.getString(fe, "name");
      }
    }

    public String getDescriptionText(Object parameterObject) {
      return this.getDescriptionText_internal((Pair) parameterObject);
    }

    public String getDescriptionText_internal(Pair parameterObject) {
      SNode fe = (SNode) parameterObject.o1;
      if ((fe == null)) {
        return "all features";
      } else
      if (SNodeOperations.isInstanceOf(fe, "jetbrains.mps.ypath.structure.IParamFeature")) {
        return "parameterized feature in " + SPropertyOperations.getString(SNodeOperations.cast(SNodeOperations.getParent(fe), "jetbrains.mps.lang.core.structure.INamedConcept"), "name");
      } else {
        return "feature in " + SPropertyOperations.getString(SNodeOperations.cast(SNodeOperations.getParent(fe), "jetbrains.mps.lang.core.structure.INamedConcept"), "name");
      }
    }
  }
}
