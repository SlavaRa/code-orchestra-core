package jetbrains.mps.graphLayout.planarGraph;

/*Generated by MPS */

import jetbrains.mps.graphLayout.graph.Graph;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.backports.LinkedList;
import jetbrains.mps.graphLayout.graph.Node;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.ISelector;
import jetbrains.mps.internal.collections.runtime.IWhereFilter;

public class Face {
  private Graph myGraph;
  private List<Dart> myDarts;

  public Face(Graph graph) {
    myGraph = graph;
    myDarts = ListSequence.fromList(new LinkedList<Dart>());
  }

  public void addLast(Dart dart) {
    ListSequence.fromList(myDarts).addElement(dart);
  }

  public void addFirst(Dart dart) {
    ListSequence.fromList(myDarts).insertElement(0, dart);
  }

  public List<Dart> getDarts() {
    return myDarts;
  }

  public boolean contains(List<Node> nodes) {
    Set<Node> faceNodes = SetSequence.fromSet(new HashSet<Node>());
    SetSequence.fromSet(faceNodes).addSequence(ListSequence.fromList(myDarts).select(new ISelector<Dart, Node>() {
      public Node select(Dart it) {
        return it.getSource();
      }
    }));
    return SetSequence.fromSet(faceNodes).containsSequence(ListSequence.fromList(nodes));
  }

  public List<Dart> makeEndsWith(final Node end) {
    Dart dart = ListSequence.fromList(myDarts).findFirst(new IWhereFilter<Dart>() {
      public boolean accept(Dart it) {
        return it.getTarget() == end;
      }
    });
    if (dart == null) {
      throw new RuntimeException("list " + myDarts + " doesn't contain node" + end);
    }
    return makeEndsWith(dart);
  }

  public List<Dart> makeEndsWith(Dart dart) {
    if (!(ListSequence.fromList(myDarts).contains(dart))) {
      throw new RuntimeException("list " + myDarts + " doesn't contain dart" + dart);
    }
    while (ListSequence.fromList(myDarts).last() != dart) {
      ListSequence.fromList(myDarts).insertElement(0, ListSequence.fromList(myDarts).removeLastElement());
    }
    return myDarts;
  }

  public List<Dart> makeStartsWith(Dart dart) {
    makeEndsWith(dart);
    ListSequence.fromList(myDarts).insertElement(0, ListSequence.fromList(myDarts).removeLastElement());
    return myDarts;
  }

  @Override
  public String toString() {
    StringBuilder builder = new StringBuilder();
    builder.append("Face:\n");
    for (Dart dart : ListSequence.fromList(myDarts)) {
      builder.append(dart + ", ");
    }
    builder.append("\n");
    return builder.toString();
  }
}
