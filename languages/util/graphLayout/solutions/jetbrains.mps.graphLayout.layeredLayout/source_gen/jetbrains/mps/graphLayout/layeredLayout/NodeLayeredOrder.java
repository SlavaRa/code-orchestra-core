package jetbrains.mps.graphLayout.layeredLayout;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.graphLayout.graph.Node;
import java.util.Map;
import jetbrains.mps.graphLayout.graph.Graph;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.graphLayout.util.NodeMap;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.Iterator;

public class NodeLayeredOrder {
  private List<List<Node>> myLayeredOrder;
  private Map<Node, Integer> myPosInLayer;
  private Graph myGraph;

  public NodeLayeredOrder(Graph graph) {
    myGraph = graph;
    myLayeredOrder = ListSequence.fromList(new ArrayList<List<Node>>());
    myPosInLayer = new NodeMap<Integer>(graph);
  }

  public void addLast(Node node, int layer) {
    if (ListSequence.fromList(myLayeredOrder).count() <= layer) {
      for (int i = ListSequence.fromList(myLayeredOrder).count(); i <= layer; i++) {
        ListSequence.fromList(myLayeredOrder).addElement(ListSequence.fromList(new ArrayList<Node>()));
      }
    }
    MapSequence.fromMap(myPosInLayer).put(node, ListSequence.fromList(ListSequence.fromList(myLayeredOrder).getElement(layer)).count());
    ListSequence.fromList(ListSequence.fromList(myLayeredOrder).getElement(layer)).addElement(node);
  }

  public void setLayer(List<Node> nodes, int layer) {
    ListSequence.fromList(myLayeredOrder).setElement(layer, nodes);
    for (int i = 0; i < ListSequence.fromList(nodes).count(); i++) {
      MapSequence.fromMap(myPosInLayer).put(ListSequence.fromList(nodes).getElement(i), i);
    }
  }

  public void set(int layer, Node node, int pos) {
    ListSequence.fromList(ListSequence.fromList(myLayeredOrder).getElement(layer)).setElement(pos, node);
    MapSequence.fromMap(myPosInLayer).put(node, pos);
  }

  public Map<Node, Integer> getPosInLayer() {
    return myPosInLayer;
  }

  public List<Node> getOrder(int layer) {
    return ListSequence.fromList(myLayeredOrder).getElement(layer);
  }

  public int getNumLayers() {
    return ListSequence.fromList(myLayeredOrder).count();
  }

  public Graph getGraph() {
    return this.myGraph;
  }

  @Override
  public String toString() {
    StringBuilder builder = new StringBuilder();
    builder.append("Node layered order: \n");
    for (List<Node> layerOrder : ListSequence.fromList(myLayeredOrder)) {
      for (Node node : ListSequence.fromList(layerOrder)) {
        builder.append(node.getIndex() + " ");
      }
      builder.append("\n");
    }
    builder.append("end order");
    return builder.toString();
  }

  public Iterator<List<Node>> getTopToBottomIterator() {
    return ListSequence.fromList(myLayeredOrder).iterator();
  }

  public Iterator<List<Node>> getBottomToTopIterator() {
    return ListSequence.fromList(myLayeredOrder).reversedList().iterator();
  }
}
