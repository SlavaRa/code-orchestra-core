package jetbrains.mps.buildlanguage.plugin;

/*Generated by MPS */

import jetbrains.mps.smodel.SNode;
import java.util.List;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.smodel.ModelAccess;
import jetbrains.mps.internal.collections.runtime.ListSequence;

public class TargetChoosePanel extends ChildChoosePanel<SNode, SNode> {
  public TargetChoosePanel() {
    super("Target:");
  }

  public List<SNode> getChildrenNodes(SNode node) {
    return SLinkOperations.getTargets(node, "target", true);
  }

  protected String selectFromChangedNode(final SNode node) {
    final Wrappers._T<String> child = new Wrappers._T<String>(null);
    ModelAccess.instance().runReadAction(new Runnable() {
      public void run() {
        if ((SLinkOperations.getTarget(node, "default", true) != null) && (SLinkOperations.getTarget(SLinkOperations.getTarget(node, "default", true), "targetDeclaration", false) != null)) {
          child.value = ((SNode) SLinkOperations.getTarget(SLinkOperations.getTarget(node, "default", true), "targetDeclaration", false)).getId();
        } else {
          List<SNode> childrenNodes = getChildrenNodes(node);
          if (childrenNodes != null && ListSequence.fromList(childrenNodes).isNotEmpty()) {
            child.value = ((SNode) ListSequence.fromList(childrenNodes).first()).getId();
          }
        }
      }
    });
    return child.value;
  }
}
